###############################################################################
# LU·ªíNG API ƒê·∫∂T PH√íNG HO√ÄN CH·ªàNH - T·ª™ GUEST BOOKING ƒê·∫æN MANAGER CONFIRM
# Updated: December 7, 2025
###############################################################################

# === T·ªîNG QUAN LU·ªíNG ===
# 
# B∆Ø·ªöC 1: Guest/User t·∫°o booking ‚Üí Status: Pending
# B∆Ø·ªöC 2: Guest b√°o ƒë√£ chuy·ªÉn kho·∫£n ‚Üí Status: PendingConfirmation (tr√™n m√†n h√¨nh QR th√™m 2 button t√¥i ƒë√£ chuy·ªÉn kho·∫£n ho·∫∑c hu·ª∑ -> redirect trang FE n√†o th√¨ tu·ª≥)
# B∆Ø·ªöC 3: Manager ki·ªÉm tra bill ng√¢n h√†ng v√† confirm ‚Üí Status: Confirmed
# B∆Ø·ªöC 4 (Optional): Manager h·ªßy booking n·∫øu kh√¥ng nh·∫≠n ƒë∆∞·ª£c ti·ªÅn ‚Üí Status: Cancelled
#
# === TR·∫†NG TH√ÅI BOOKING ===
# - Pending: V·ª´a t·∫°o booking, ƒëang ch·ªù kh√°ch chuy·ªÉn kho·∫£n (15 ph√∫t t·ª± ƒë·ªông h·ªßy)
# - PendingConfirmation: Kh√°ch ƒë√£ b√°o chuy·ªÉn kho·∫£n, ch·ªù manager ki·ªÉm tra
# - Confirmed: Manager ƒë√£ x√°c nh·∫≠n nh·∫≠n ƒë∆∞·ª£c ti·ªÅn c·ªçc
# - Cancelled: Booking b·ªã h·ªßy (timeout ho·∫∑c kh√¥ng thanh to√°n)
# - CheckedIn: Kh√°ch ƒë√£ check-in t·∫°i kh√°ch s·∫°n
# - Completed: ƒê√£ check-out, ho√†n th√†nh
#
###############################################################################

@baseUrl = http://localhost:8080
@managerToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6IjIiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoibWFuYWdlciIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6Ik1hbmFnZXIiLCJqdGkiOiIyOTBmYWNhZi04NDUxLTQxOWYtYTlkYi00MWIwZTkxZGQyYmEiLCJuYmYiOjE3NjUwODU0MTAsImV4cCI6MTc2NTA4NzIxMCwiaXNzIjoiQXBwQmFja2VuZCIsImF1ZCI6IkFwcEJhY2tlbmRVc2VycyJ9.t1hMRUoNf39AfPaBdo6P59N8Y5Sqk2cgvNNZOlDKQIc

###############################################################################
# B∆Ø·ªöC 1: GUEST T·∫†O BOOKING
###############################################################################

### 1.1. Ki·ªÉm tra ph√≤ng tr·ªëng tr∆∞·ªõc khi ƒë·∫∑t
POST {{baseUrl}}/api/Booking/check-availability
Content-Type: application/json

{
  "roomTypes": [
    {
      "roomTypeId": 1,
      "quantity": 1
    }
  ],
  "checkInDate": "2025-12-20T14:00:00Z",
  "checkOutDate": "2025-12-22T12:00:00Z"
}

# Response mong ƒë·ª£i:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "data": {
#     "isAllAvailable": true,
#     "checkInDate": "2025-12-20T14:00:00Z",
#     "checkOutDate": "2025-12-22T12:00:00Z",
#     "totalNights": 2,
#     "roomTypes": [
#       {
#         "roomTypeId": 1,
#         "roomTypeName": "Ph√≤ng Ti√™u Chu·∫©n",
#         "availableCount": 5,
#         "requestedQuantity": 1,
#         "isAvailable": true,
#         "basePriceNight": 800000
#       }
#     ]
#   }
# }

###############################################################################

### 1.2. Guest t·∫°o booking (KH√îNG C·∫¶N ƒêƒÇNG NH·∫¨P)
# N·∫øu c√≥ email ‚Üí T·ª± ƒë·ªông t·∫°o t√†i kho·∫£n cho guest
POST {{baseUrl}}/api/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguyen Van A",
  "email": "nguyenvana@example.com",
  "phoneNumber": "0987654321",
  "identityCard": "012345678901",
  "address": "123 Nguyen Trai, Ha Noi",
  "roomTypes": [
    {
      "roomTypeId": 1,
      "quantity": 1
    }
  ],
  "checkInDate": "2025-12-20T14:00:00Z",
  "checkOutDate": "2025-12-22T12:00:00Z",
  "specialRequests": "T·∫ßng cao, view ƒë·∫πp"
}

# Response mong ƒë·ª£i:
# {
#   "isSuccess": true,
#   "statusCode": 201,
#   "message": "T·∫°o booking th√†nh c√¥ng. Vui l√≤ng qu√©t m√£ QR ƒë·ªÉ thanh to√°n trong 15 ph√∫t!",
#   "data": {
#     "booking": {
#       "bookingId": 123,
#       "customerId": 45,
#       "customerName": "Nguyen Van A",
#       "roomIds": [101],
#       "roomNames": ["101"],
#       "checkInDate": "2025-12-20T14:00:00Z",
#       "checkOutDate": "2025-12-22T12:00:00Z",
#       "totalAmount": 1600000,
#       "depositAmount": 480000,
#       "paymentStatus": "Pending",
#       "bookingType": "Online",
#       "orderCode": "TRX000123251207123456"
#     },
#     "bookingToken": "abc123xyz789",
#     "qrPayment": {
#       "qrCodeUrl": "https://img.vietqr.io/image/MB-8366925012003-compact2.jpg?amount=480000&addInfo=Dat%20coc%20booking%20123&accountName=StayHub",
#       "bankName": "MB Bank",
#       "bankCode": "MB",
#       "accountNumber": "8366925012003",
#       "accountName": "StayHub",
#       "amount": 480000,
#       "description": "Dat coc booking 123",
#       "transactionRef": "TRX000123251207123456"
#     },
#     "paymentDeadline": "2025-12-07T12:15:00Z"
#   }
# }

# ‚ö†Ô∏è L∆ØU √ù:
# - L∆∞u l·∫°i bookingId = 123 v√† bookingToken ƒë·ªÉ d√πng cho c√°c b∆∞·ªõc ti·∫øp theo
# - QR code c√≥ hi·ªáu l·ª±c 15 ph√∫t
# - N·∫øu c√≥ email, h·ªá th·ªëng t·ª± ƒë·ªông t·∫°o t√†i kho·∫£n v·ªõi:
#   + Username: nguyenvana_123456 (email + timestamp)
#   + Password: Random (s·∫Ω g·ª≠i email h∆∞·ªõng d·∫´n reset password)
#   + Role: User
#   + Customer.AccountId ƒë∆∞·ª£c li√™n k·∫øt v·ªõi Account m·ªõi t·∫°o

###############################################################################
# B∆Ø·ªöC 2: GUEST QU√âT QR V√Ä CHUY·ªÇN KHO·∫¢N
###############################################################################

# Guest qu√©t QR code v√† chuy·ªÉn kho·∫£n qua app ng√¢n h√†ng
# N·ªôi dung chuy·ªÉn kho·∫£n: "Dat coc booking 123"
# S·ªë ti·ªÅn: 480,000 VNƒê

###############################################################################

### 2.1. Guest x√°c nh·∫≠n ƒë√£ chuy·ªÉn kho·∫£n
POST {{baseUrl}}/api/Booking/confirm-payment
Content-Type: application/json

{
  "bookingId": 123,
  "isCancel": false
}

# Response mong ƒë·ª£i:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "C·∫£m ∆°n b·∫°n ƒë√£ th√¥ng b√°o thanh to√°n. Qu·∫£n l√Ω s·∫Ω ki·ªÉm tra bill ng√¢n h√†ng v√† x√°c nh·∫≠n trong th·ªùi gian s·ªõm nh·∫•t."
# }

# ‚ö†Ô∏è SAU B∆Ø·ªöC N√ÄY:
# - Booking status chuy·ªÉn t·ª´ "Pending" ‚Üí "PendingConfirmation"
# - H·ªá th·ªëng g·ª≠i email cho Manager ƒë·ªÉ ki·ªÉm tra bill ng√¢n h√†ng
# - Guest nh·∫≠n email th√¥ng b√°o ƒëang ch·ªù x√°c nh·∫≠n

###############################################################################

### 2.2. (Optional) Guest ki·ªÉm tra tr·∫°ng th√°i booking qua token
GET {{baseUrl}}/api/Booking/mybooking/abc123xyz789

# Response:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "data": {
#     "bookingId": 123,
#     "customerName": "Nguyen Van A",
#     "paymentStatus": "Ch·ªù x√°c nh·∫≠n",
#     "roomNames": ["101"],
#     "checkInDate": "2025-12-20T14:00:00Z",
#     "checkOutDate": "2025-12-22T12:00:00Z",
#     "totalAmount": 1600000,
#     "depositAmount": 480000
#   }
# }

###############################################################################
# B∆Ø·ªöC 3: MANAGER KI·ªÇM TRA V√Ä X√ÅC NH·∫¨N THANH TO√ÅN
###############################################################################

### 3.1. Manager ƒëƒÉng nh·∫≠p (n·∫øu ch∆∞a c√≥ token)
POST {{baseUrl}}/api/Auth/login
Content-Type: application/json

{
  "username": "manager",
  "password": "Manager@123"
}

# L∆∞u l·∫°i token t·ª´ response ƒë·ªÉ d√πng cho c√°c API ti·∫øp theo

###############################################################################

### 3.2. Manager xem danh s√°ch booking ch·ªù x√°c nh·∫≠n
# (Gi·∫£ s·ª≠ c√≥ API list bookings v·ªõi filter status)
GET {{baseUrl}}/api/BookingManagement/bookings?status=PendingConfirmation
Authorization: Bearer {{managerToken}}

###############################################################################

### 3.3. Manager xem chi ti·∫øt booking
GET {{baseUrl}}/api/BookingManagement/123
Authorization: Bearer {{managerToken}}

# Response:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "data": {
#     "bookingId": 123,
#     "customerId": 45,
#     "customerName": "Nguyen Van A",
#     "customerEmail": "nguyenvana@example.com",
#     "customerPhone": "0987654321",
#     "paymentStatus": "Ch·ªù x√°c nh·∫≠n",
#     "totalAmount": 1600000,
#     "depositAmount": 480000,
#     "roomNames": ["101"]
#   }
# }

###############################################################################

### 3.4. Manager ki·ªÉm tra bill ng√¢n h√†ng (Th·ªß c√¥ng qua app ng√¢n h√†ng)
# - Ki·ªÉm tra c√≥ giao d·ªãch chuy·ªÉn kho·∫£n 480,000 VNƒê kh√¥ng
# - Ki·ªÉm tra n·ªôi dung: "Dat coc booking 123"
# - Ki·ªÉm tra ng∆∞·ªùi chuy·ªÉn (t√™n ho·∫∑c SƒêT kh·ªõp kh√¥ng)

###############################################################################

### 3.5. Manager X√ÅC NH·∫¨N ƒë√£ nh·∫≠n ƒë∆∞·ª£c ti·ªÅn (QUAN TR·ªåNG NH·∫§T)
POST {{baseUrl}}/api/BookingManagement/123/confirm-payment
Authorization: Bearer {{managerToken}}

# Response mong ƒë·ª£i:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "X√°c nh·∫≠n thanh to√°n th√†nh c√¥ng. Email x√°c nh·∫≠n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn kh√°ch h√†ng."
# }

# ‚ö†Ô∏è SAU B∆Ø·ªöC N√ÄY:
# - Booking status chuy·ªÉn t·ª´ "PendingConfirmation" ‚Üí "Confirmed"
# - Booking.TotalAmount v√† DepositAmount ƒë∆∞·ª£c t√≠nh l·∫°i (n·∫øu c·∫ßn)
# - H·ªá th·ªëng g·ª≠i email x√°c nh·∫≠n booking cho kh√°ch h√†ng
# - Ph√≤ng ch√≠nh th·ª©c ƒë∆∞·ª£c ƒë·∫∑t, kh√¥ng c√≤n available cho ng∆∞·ªùi kh√°c

###############################################################################

### 3.6. (Optional) Manager H·ª¶Y booking n·∫øu kh√¥ng nh·∫≠n ƒë∆∞·ª£c ti·ªÅn
DELETE {{baseUrl}}/api/BookingManagement/123/cancel
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "reason": "Kh√¥ng nh·∫≠n ƒë∆∞·ª£c chuy·ªÉn kho·∫£n sau 24h"
}

# Response:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "ƒê√£ h·ªßy booking th√†nh c√¥ng"
# }

# ‚ö†Ô∏è SAU B∆Ø·ªöC N√ÄY:
# - Booking status ‚Üí "Cancelled"
# - Ph√≤ng tr·ªü l·∫°i available
# - G·ª≠i email th√¥ng b√°o h·ªßy cho kh√°ch

###############################################################################
# B∆Ø·ªöC 4: GUEST KI·ªÇM TRA TR·∫†NG TH√ÅI SAU KHI MANAGER CONFIRM
###############################################################################

### 4.1. Guest ki·ªÉm tra booking ƒë√£ ƒë∆∞·ª£c confirm
GET {{baseUrl}}/api/Booking/mybooking/abc123xyz789

# Response:
# {
#   "isSuccess": true,
#   "statusCode": 200,
#   "data": {
#     "bookingId": 123,
#     "customerName": "Nguyen Van A",
#     "paymentStatus": "ƒê√£ x√°c nh·∫≠n",  ‚Üê ƒê√É THAY ƒê·ªîI
#     "roomNames": ["101"],
#     "checkInDate": "2025-12-20T14:00:00Z",
#     "checkOutDate": "2025-12-22T12:00:00Z",
#     "totalAmount": 1600000,
#     "depositAmount": 480000
#   }
# }

###############################################################################
# T·ªîNG K·∫æT LU·ªíNG
###############################################################################

# ‚úÖ LU·ªíNG TH√ÄNH C√îNG:
# Guest t·∫°o booking (Pending) 
#   ‚Üí Guest qu√©t QR chuy·ªÉn kho·∫£n 
#   ‚Üí Guest confirm ƒë√£ chuy·ªÉn (PendingConfirmation)
#   ‚Üí Manager ki·ªÉm tra bill ng√¢n h√†ng
#   ‚Üí Manager confirm payment (Confirmed)
#   ‚Üí Guest nh·∫≠n email x√°c nh·∫≠n
#   ‚Üí Check-in ng√†y 20/12 (CheckedIn)
#   ‚Üí Check-out ng√†y 22/12 (Completed)

# ‚ùå LU·ªíNG H·ª¶Y (Timeout):
# Guest t·∫°o booking (Pending)
#   ‚Üí Guest KH√îNG qu√©t QR / KH√îNG chuy·ªÉn kho·∫£n
#   ‚Üí Sau 15 ph√∫t: T·ª± ƒë·ªông h·ªßy (Cancelled)
#   ‚Üí Ph√≤ng tr·ªü l·∫°i available

# ‚ùå LU·ªíNG H·ª¶Y (Manager t·ª´ ch·ªëi):
# Guest t·∫°o booking (Pending)
#   ‚Üí Guest b√°o ƒë√£ chuy·ªÉn (PendingConfirmation)
#   ‚Üí Manager ki·ªÉm tra KH√îNG th·∫•y ti·ªÅn
#   ‚Üí Manager h·ªßy booking (Cancelled)
#   ‚Üí Guest nh·∫≠n email th√¥ng b√°o h·ªßy

###############################################################################
# C√ÅC API QUAN TR·ªåNG
###############################################################################

# 1. POST /api/Booking/guest
#    - Guest t·∫°o booking (kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p)
#    - Tr·∫£ v·ªÅ QR payment info
#    - T·ª± ƒë·ªông t·∫°o t√†i kho·∫£n n·∫øu c√≥ email

# 2. POST /api/Booking/confirm-payment
#    - Guest x√°c nh·∫≠n ƒë√£ chuy·ªÉn kho·∫£n
#    - Status: Pending ‚Üí PendingConfirmation

# 3. POST /api/BookingManagement/{id}/confirm-payment
#    - Manager x√°c nh·∫≠n ƒë√£ nh·∫≠n ti·ªÅn
#    - Status: PendingConfirmation ‚Üí Confirmed
#    - ‚ö†Ô∏è API QUAN TR·ªåNG NH·∫§T

# 4. GET /api/Booking/mybooking/{token}
#    - Guest ki·ªÉm tra tr·∫°ng th√°i booking
#    - Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p

# 5. DELETE /api/BookingManagement/{id}/cancel
#    - Manager h·ªßy booking
#    - Status: Any ‚Üí Cancelled

###############################################################################
# M·∫∏O V√Ä L∆ØU √ù
###############################################################################

# üí° BEST PRACTICES:
# - Lu√¥n ki·ªÉm tra availability tr∆∞·ªõc khi t·∫°o booking
# - L∆∞u bookingToken ƒë·ªÉ guest c√≥ th·ªÉ tra c·ª©u kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p
# - Manager n√™n confirm trong v√≤ng 24h ƒë·ªÉ tr√°nh kh√°ch h√†ng ch·ªù l√¢u
# - C√≥ th·ªÉ setup webhook t·ª´ ng√¢n h√†ng ƒë·ªÉ t·ª± ƒë·ªông confirm (n√¢ng cao)

# üîí B·∫¢O M·∫¨T:
# - BookingToken ƒë∆∞·ª£c m√£ h√≥a, ch·ªâ d√πng ƒë·ªÉ xem th√¥ng tin booking
# - Manager ph·∫£i c√≥ role "Manager" ho·∫∑c "Admin" m·ªõi confirm ƒë∆∞·ª£c
# - Guest kh√¥ng th·ªÉ t·ª± confirm booking c·ªßa m√¨nh

# üìß EMAIL:
# - Guest nh·∫≠n email sau khi t·∫°o booking (k√®m QR code)
# - Guest nh·∫≠n email sau khi b√°o ƒë√£ chuy·ªÉn kho·∫£n
# - Manager nh·∫≠n email khi guest b√°o ƒë√£ chuy·ªÉn kho·∫£n
# - Guest nh·∫≠n email x√°c nh·∫≠n sau khi manager confirm

# ‚è±Ô∏è TIMEOUT:
# - Booking Pending: T·ª± ƒë·ªông h·ªßy sau 15 ph√∫t n·∫øu kh√¥ng thanh to√°n
# - Booking PendingConfirmation: KH√îNG t·ª± ƒë·ªông h·ªßy, ch·ªù manager x√°c nh·∫≠n

###############################################################################

