### ===================================
### BOOKING MANAGEMENT FLOW - L·ªÑ T√ÇN
### ===================================
### 
### Lu·ªìng ƒë·∫∑t ph√≤ng t·∫°i qu·∫ßy (Offline Booking):
### 1. ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n L·ªÖ t√¢n
### 2. T√¨m ki·∫øm customer (n·∫øu l√† kh√°ch c≈©)
### 3. Ki·ªÉm tra ph√≤ng available v·ªõi filter
### 4. T·∫°o booking offline (Walkin) v·ªõi deposit
### 5. X√°c nh·∫≠n thanh to√°n deposit
### 6. C·∫≠p nh·∫≠t th√¥ng tin booking (n·∫øu c·∫ßn)
### 7. Qu·∫£n l√Ω danh s√°ch booking
### 8. X√°c nh·∫≠n thanh to√°n to√†n b·ªô khi check-out
### 9. H·ªßy booking (n·∫øu c·∫ßn)
###
### Base URL: http://localhost:8080
### ===================================

@baseUrl = http://localhost:8080

### ===================================
### B∆Ø·ªöC 1: ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n L·ªÖ t√¢n
### ===================================
### Credentials:
### - Username: receptionist
### - Password: Staff@123
### - Role: Receptionist

# @name login
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "receptionist@hotel.com",
  "password": "Staff@123"
}

###

### L∆∞u token t·ª´ response
@token = {{login.response.body.data.token}}

### ===================================
### B∆Ø·ªöC 2: T√¨m ki·∫øm customer (kh√°ch c≈©)
### ===================================
### T·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin n·∫øu kh√°ch ƒë√£ t·ª´ng ƒë·∫∑t ph√≤ng
### T√¨m theo email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i

GET {{baseUrl}}/api/BookingManagement/search-customer?searchTerm=0901234567
Authorization: Bearer {{token}}

### Response Example (Found):
### {
###   "isSuccess": true,
###   "data": {
###     "customerId": 1,
###     "fullName": "Nguy·ªÖn VƒÉn A",
###     "email": "nguyenvana@gmail.com",
###     "phoneNumber": "0901234567",
###     "identityCard": "001234567890",
###     "address": "123 ƒê∆∞·ªùng ABC, TP.HCM",
###     "totalBookings": 3,
###     "lastBookingDate": "2025-11-10T10:00:00Z"
###   }
### }

### Response Example (Not Found):
### {
###   "isSuccess": true,
###   "data": null,
###   "message": "Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng"
### }

### ===================================
### B∆Ø·ªöC 3: Ki·ªÉm tra ph√≤ng available
### ===================================
### Check ph√≤ng tr·ªëng theo:
### - Lo·∫°i ph√≤ng (roomTypeId)
### - S·ªë l∆∞·ª£ng ph√≤ng c·∫ßn ƒë·∫∑t
### - Ng√†y check-in / check-out
### ‚ö†Ô∏è T·ª± ƒë·ªông lo·∫°i b·ªè ph√≤ng ƒëang b·ªã lock trong cache

POST {{baseUrl}}/api/BookingManagement/available-rooms
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "roomTypes": [
    {
      "roomTypeId": 1,
      "quantity": 2
    }
  ],
  "checkInDate": "2025-11-20T14:00:00Z",
  "checkOutDate": "2025-11-22T12:00:00Z"
}

### Response Example:
### {
###   "isSuccess": true,
###   "data": {
###     "isAllAvailable": true,
###     "message": "‚úì T·∫•t c·∫£ lo·∫°i ph√≤ng ƒë·ªÅu c√≥ ƒë·ªß s·ªë l∆∞·ª£ng",
###     "roomTypes": [
###       {
###         "roomTypeId": 1,
###         "roomTypeName": "Ph√≤ng Ti√™u Chu·∫©n",
###         "roomTypeCode": "STD",
###         "basePriceNight": 800000,
###         "availableCount": 5,
###         "requestedQuantity": 2,
###         "isAvailable": true,
###         "message": "‚úì C√≤n 5 ph√≤ng tr·ªëng, ƒë·ªß ƒë·ªÉ ƒë√°p ·ª©ng y√™u c·∫ßu 2 ph√≤ng"
###       }
###     ],
###     "checkInDate": "2025-11-20T14:00:00Z",
###     "checkOutDate": "2025-11-22T12:00:00Z",
###     "totalNights": 2
###   }
### }

### ===================================
### B∆Ø·ªöC 4: T·∫°o booking offline (Walkin)
### ===================================
### L·ªÖ t√¢n nh·∫≠p th√¥ng tin kh√°ch t·∫°i qu·∫ßy
### ‚ú® BookingType s·∫Ω t·ª± ƒë·ªông = "Walkin"
### üí∞ C√≥ th·ªÉ nh·∫≠n deposit ngay (ti·ªÅn m·∫∑t/th·∫ª/chuy·ªÉn kho·∫£n)

# @name createBooking
POST {{baseUrl}}/api/BookingManagement/offline-booking
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn B",
  "email": "nguyenvanb@gmail.com",
  "phoneNumber": "0912345678",
  "identityCard": "012345678901",
  "address": "456 ƒê∆∞·ªùng XYZ, H√† N·ªôi",
  "roomTypes": [
    {
      "roomTypeId": 1,
      "quantity": 1
    }
  ],
  "checkInDate": "2025-11-20T14:00:00Z",
  "checkOutDate": "2025-11-22T12:00:00Z",
  "specialRequests": "T·∫ßng cao, view bi·ªÉn",
  "depositAmount": 500000,
  "paymentMethod": "Cash",
  "paymentNote": "Kh√°ch ƒë·∫∑t c·ªçc ti·ªÅn m·∫∑t t·∫°i qu·∫ßy"
}

### Response Example:
### {
###   "isSuccess": true,
###   "statusCode": 201,
###   "data": {
###     "bookingId": 15
###   },
###   "message": "T·∫°o booking offline th√†nh c√¥ng"
### }

@bookingId = {{createBooking.response.body.$.data.bookingId}}

### ===================================
### B∆Ø·ªöC 5: Xem chi ti·∫øt booking v·ª´a t·∫°o
### ===================================

GET {{baseUrl}}/api/BookingManagement/offline-booking/{{bookingId}}
Authorization: Bearer {{token}}

### Response s·∫Ω hi·ªÉn th·ªã:
### - Th√¥ng tin kh√°ch h√†ng
### - Danh s√°ch ph√≤ng ƒë√£ ƒë·∫∑t
### - T·ªïng ti·ªÅn, ti·ªÅn c·ªçc, c√≤n l·∫°i
### - Tr·∫°ng th√°i thanh to√°n
### - L·ªãch s·ª≠ giao d·ªãch

### ===================================
### B∆Ø·ªöC 6: C·∫≠p nh·∫≠t th√¥ng tin booking (n·∫øu c·∫ßn)
### ===================================
### Ch·ªâ c·∫≠p nh·∫≠t ƒë∆∞·ª£c tr∆∞·ªõc khi check-in

PUT {{baseUrl}}/api/BookingManagement/offline-booking/{{bookingId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn B Updated",
  "phoneNumber": "0912345679",
  "specialRequests": "T·∫ßng cao, view bi·ªÉn, th√™m gi∆∞·ªùng ph·ª•"
}

### ===================================
### B∆Ø·ªöC 7: X√°c nh·∫≠n thanh to√°n deposit b·ªï sung (n·∫øu c·∫ßn)
### ===================================
### Tr∆∞·ªùng h·ª£p kh√°ch ƒë·∫∑t c·ªçc th√™m

POST {{baseUrl}}/api/BookingManagement/offline-booking/{{bookingId}}/confirm-deposit
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "depositAmount": 300000,
  "paymentMethod": "Card",
  "paymentNote": "Kh√°ch ƒë·∫∑t c·ªçc th√™m b·∫±ng th·∫ª",
  "transactionReference": "TXN-2025111601"
}

### ===================================
### B∆Ø·ªöC 8: L·∫•y danh s√°ch t·∫•t c·∫£ booking offline
### ===================================
### M√†n h√¨nh qu·∫£n l√Ω booking v·ªõi filter ƒë·∫ßy ƒë·ªß

GET {{baseUrl}}/api/BookingManagement/offline-bookings?pageNumber=1&pageSize=20
Authorization: Bearer {{token}}

### Ho·∫∑c filter theo ti√™u ch√≠ c·ª• th·ªÉ:
GET {{baseUrl}}/api/BookingManagement/offline-bookings?fromDate=2025-11-15&toDate=2025-11-25&paymentStatus=Unpaid&pageNumber=1&pageSize=10
Authorization: Bearer {{token}}

### Response Example:
### {
###   "isSuccess": true,
###   "data": {
###     "totalRecords": 15,
###     "pageNumber": 1,
###     "pageSize": 10,
###     "totalPages": 2,
###     "bookings": [...]
###   }
### }

### ===================================
### B∆Ø·ªöC 9: X√°c nh·∫≠n thanh to√°n to√†n b·ªô (khi check-out)
### ===================================
### Kh√°ch thanh to√°n ph·∫ßn c√≤n l·∫°i khi tr·∫£ ph√≤ng
### üìß T·ª± ƒë·ªông g·ª≠i email c·∫£m ∆°n sau khi thanh to√°n

POST {{baseUrl}}/api/BookingManagement/offline-booking/{{bookingId}}/confirm-payment
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "paidAmount": 1100000,
  "paymentMethod": "Cash",
  "paymentNote": "Thanh to√°n ph·∫ßn c√≤n l·∫°i khi check-out",
  "transactionReference": "TXN-2025111602"
}

### Response:
### {
###   "isSuccess": true,
###   "message": "X√°c nh·∫≠n thanh to√°n th√†nh c√¥ng"
### }

### ===================================
### B∆Ø·ªöC 10: G·ª≠i l·∫°i email x√°c nh·∫≠n (n·∫øu c·∫ßn)
### ===================================

POST {{baseUrl}}/api/BookingManagement/offline-booking/{{bookingId}}/resend-email
Authorization: Bearer {{token}}

### ===================================
### B∆Ø·ªöC 11: H·ªßy booking (n·∫øu kh√°ch h·ªßy)
### ===================================
### Ch·ªâ h·ªßy ƒë∆∞·ª£c tr∆∞·ªõc khi check-in

DELETE {{baseUrl}}/api/BookingManagement/offline-booking/{{bookingId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "reason": "Kh√°ch h·ªßy do thay ƒë·ªïi l·ªãch tr√¨nh"
}

### ===================================
### ADVANCED SCENARIOS
### ===================================

### Scenario 1: Kh√°ch c≈© quay l·∫°i ƒë·∫∑t ph√≤ng
### T√¨m theo email ‚Üí T·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin ‚Üí T·∫°o booking m·ªõi

GET {{baseUrl}}/api/BookingManagement/search-customer?searchTerm=nguyenvana@gmail.com
Authorization: Bearer {{token}}

### Sau ƒë√≥ d√πng th√¥ng tin t√¨m ƒë∆∞·ª£c ƒë·ªÉ t·∫°o booking v·ªõi email/SƒêT ƒë√£ c√≥

### Scenario 2: Booking nhi·ªÅu lo·∫°i ph√≤ng c√πng l√∫c

POST {{baseUrl}}/api/BookingManagement/offline-booking
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fullName": "Tr·∫ßn Th·ªã C",
  "email": "tranthic@gmail.com",
  "phoneNumber": "0923456789",
  "roomTypes": [
    {
      "roomTypeId": 1,
      "quantity": 2
    },
    {
      "roomTypeId": 3,
      "quantity": 1
    }
  ],
  "checkInDate": "2025-11-25T14:00:00Z",
  "checkOutDate": "2025-11-27T12:00:00Z",
  "depositAmount": 1000000,
  "paymentMethod": "Bank"
}

### Scenario 3: Filter booking theo nhi·ªÅu ti√™u ch√≠

GET {{baseUrl}}/api/BookingManagement/offline-bookings?fromDate=2025-11-01&toDate=2025-11-30&paymentStatus=Unpaid&depositStatus=Paid&customerName=Nguyen&phoneNumber=090&pageNumber=1&pageSize=20
Authorization: Bearer {{token}}

### ===================================
### ERROR CASES - Test c√°c tr∆∞·ªùng h·ª£p l·ªói
### ===================================

### Error 1: Kh√¥ng ƒë·ªß ph√≤ng
POST {{baseUrl}}/api/BookingManagement/offline-booking
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fullName": "Test User",
  "email": "test@test.com",
  "phoneNumber": "0900000000",
  "roomTypes": [
    {
      "roomTypeId": 1,
      "quantity": 999
    }
  ],
  "checkInDate": "2025-11-20T14:00:00Z",
  "checkOutDate": "2025-11-22T12:00:00Z",
  "depositAmount": 0,
  "paymentMethod": "Cash"
}

### Error 2: C·∫≠p nh·∫≠t booking ƒë√£ check-in (s·∫Ω b·ªã l·ªói)
PUT {{baseUrl}}/api/BookingManagement/offline-booking/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fullName": "Updated Name"
}

### Error 3: H·ªßy booking ƒë√£ check-in (s·∫Ω b·ªã l·ªói)
DELETE {{baseUrl}}/api/BookingManagement/offline-booking/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "reason": "Test cancel"
}

### Error 4: Truy c·∫≠p kh√¥ng c√≥ quy·ªÅn (kh√¥ng ph·∫£i l·ªÖ t√¢n)
GET {{baseUrl}}/api/BookingManagement/offline-bookings
### Kh√¥ng c√≥ Authorization header ‚Üí 401 Unauthorized

### ===================================
### NOTES
### ===================================
### 
### 1. BookingType:
###    - "Walkin" = ƒê·∫∑t t·∫°i qu·∫ßy (booking c·ªßa l·ªÖ t√¢n)
###    - "Online" = ƒê·∫∑t tr·ª±c tuy·∫øn (booking c·ªßa kh√°ch)
###
### 2. PaymentMethod:
###    - Cash = Ti·ªÅn m·∫∑t
###    - Card = Th·∫ª ng√¢n h√†ng
###    - Bank = Chuy·ªÉn kho·∫£n
###    - EWallet = V√≠ ƒëi·ªán t·ª≠
###
### 3. Ph√≤ng b·ªã lock trong cache:
###    - Khi c√≥ ng∆∞·ªùi ƒëang trong qu√° tr√¨nh booking
###    - Lock t·ª± ƒë·ªông expire sau 10 ph√∫t
###    - API available-rooms t·ª± ƒë·ªông lo·∫°i b·ªè ph√≤ng lock
###
### 4. Transaction History:
###    - M·ªói l·∫ßn thanh to√°n s·∫Ω t·∫°o 1 transaction record
###    - Type: Deposit ho·∫∑c FullPayment
###    - L∆∞u th√¥ng tin: Ng∆∞·ªùi x·ª≠ l√Ω, Th·ªùi gian, S·ªë ti·ªÅn
###
### ===================================
