### ROOM MANAGEMENT API - COMPREHENSIVE TEST CASES
### Test to√†n b·ªô ch·ª©c nƒÉng qu·∫£n l√Ω ph√≤ng v√† chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i theo t·ª´ng role
### Bao g·ªìm: Search, Map, Status Transitions, Role-based Permissions

@baseUrl = http://localhost:8080
@adminToken = {{login-admin.response.body.data.token}}
@managerToken = {{login-manager.response.body.data.token}}
@receptionistToken = {{login-receptionist.response.body.data.token}}
@housekeeperToken = {{login-housekeeper.response.body.data.token}}
@technicianToken = {{login-technician.response.body.data.token}}

###############################################
# 0. SETUP - Login v·ªõi c√°c role kh√°c nhau
###############################################

### 0.1. Login Admin
# @name login-admin
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "admin@hotel.com",
  "password": "Admin@123"
}

### 0.2. Login Manager
# @name login-manager
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "manager@hotel.com",
  "password": "Manager@123"
}

### 0.3. Login Receptionist
# @name login-receptionist
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "receptionist@hotel.com",
  "password": "Staff@123"
}

### 0.4. Login Housekeeper (c·∫ßn t·∫°o account tr∆∞·ªõc n·∫øu ch∆∞a c√≥)
# @name login-housekeeper
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "housekeeper@hotel.com",
  "password": "Staff@123"
}

### 0.5. Login Technician (c·∫ßn t·∫°o account tr∆∞·ªõc n·∫øu ch∆∞a c√≥)
# @name login-technician
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "technician@hotel.com",
  "password": "Staff@123"
}

###############################################
# 1. ROOM SEARCH & FILTERING (All roles)
###############################################

### 1.1. T√¨m ki·∫øm t·∫•t c·∫£ ph√≤ng (c√≥ ph√¢n trang)
GET {{baseUrl}}/api/rooms/search?pageNumber=1&pageSize=10
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "L·∫•y danh s√°ch ph√≤ng th√†nh c√¥ng",
#   "data": {
#     "rooms": [
#       {
#         "roomId": 1,
#         "roomName": "101",
#         "roomTypeId": 1,
#         "roomTypeName": "Ph√≤ng Ti√™u Chu·∫©n",
#         "roomTypeCode": "STD",
#         "basePriceNight": 800000,
#         "statusId": 1,
#         "status": "Tr·ªëng",
#         "statusCode": "Available",
#         "maxOccupancy": 2,
#         "images": ["url1", "url2"]
#       }
#     ],
#     "totalRecords": 33,
#     "pageNumber": 1,
#     "pageSize": 10,
#     "totalPages": 4
#   }
# }
# 
# ‚úÖ Validation:
# - rooms array should not be empty
# - Each room must have: roomId, roomName, roomTypeName, status, basePriceNight
# - totalRecords should be 33 (from seed data)
# - totalPages = Math.Ceiling(totalRecords / pageSize)
# - pageNumber and pageSize match request

### 1.2. T√¨m ki·∫øm theo t√™n ph√≤ng
GET {{baseUrl}}/api/rooms/search?roomName=101&pageNumber=1&pageSize=10
Authorization: Bearer {{managerToken}}

### Expected Response:
# Status: 200 OK
# ‚úÖ Validation:
# - data.rooms array contains only rooms with "101" in name
# - Could return: 101, 201, 301, 401 (if they exist)
# - totalRecords should match filtered count
# - All rooms in result should have roomName containing "101"

### 1.3. L·ªçc theo RoomTypeId (1 = Standard)
GET {{baseUrl}}/api/rooms/search?roomTypeId=1&pageNumber=1&pageSize=20
Authorization: Bearer {{receptionistToken}}

### Expected Response:
# Status: 200 OK
# ‚úÖ Validation:
# - All rooms must have roomTypeId = 1
# - All rooms should have roomTypeName = "Ph√≤ng Ti√™u Chu·∫©n"
# - All rooms should have roomTypeCode = "STD"
# - Should return rooms 101-110 (10 rooms total)

### 1.4. L·ªçc theo Status = Available
GET {{baseUrl}}/api/rooms/search?status=Available&pageNumber=1&pageSize=20
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# ‚úÖ Validation:
# - All rooms must have statusCode = "Available"
# - All rooms must have status = "Tr·ªëng"
# - totalRecords should be count of available rooms from seed data

### 1.5. L·ªçc theo t·∫ßng (Floor = 2)
GET {{baseUrl}}/api/rooms/search?floor=2&pageNumber=1&pageSize=20
Authorization: Bearer {{managerToken}}

### Expected Response:
# Status: 200 OK
# ‚úÖ Validation:
# - All rooms must have roomName starting with "2" (201-210)
# - Should return exactly 10 rooms
# - All should be Deluxe type

### 1.6. L·ªçc k·∫øt h·ª£p: T·∫ßng 3, RoomType VIP, Status Available
GET {{baseUrl}}/api/rooms/search?floor=3&roomTypeId=3&status=Available&pageNumber=1&pageSize=10
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# ‚úÖ Validation:
# - Rooms must match ALL criteria:
#   * roomName starts with "3"
#   * roomTypeId = 3 (VIP)
#   * statusCode = "Available"
# - Result count should be smaller than individual filters

###############################################
# 2. ROOM MAP & VISUALIZATION (All roles)
###############################################

### 2.1. L·∫•y s∆° ƒë·ªì t·∫•t c·∫£ t·∫ßng
GET {{baseUrl}}/api/rooms/map
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "data": [
#     {
#       "floor": 1,
#       "rooms": [
#         {
#           "roomId": 1,
#           "roomName": "101",
#           "roomTypeName": "Ph√≤ng Ti√™u Chu·∫©n",
#           "status": "Tr·ªëng",
#           "statusCode": "Available",
#           "statusColor": "#28a745"
#         }
#       ],
#       "statusSummary": {
#         "Tr·ªëng": 6,
#         "ƒê√£ ƒë·∫∑t": 2,
#         "ƒêang s·ª≠ d·ª•ng": 1,
#         "ƒêang d·ªçn d·∫πp": 0,
#         "B·∫£o tr√¨": 1
#       },
#       "totalRooms": 10
#     },
#     { "floor": 2, ... },
#     { "floor": 3, ... },
#     { "floor": 4, ... }
#   ]
# }
#
# ‚úÖ Validation:
# - Should return 4 floor objects
# - Each floor must have: floor, rooms[], statusSummary, totalRooms
# - Sum of statusSummary values = totalRooms
# - Total of all floors = 33 rooms
# - Floor 1: 10 rooms (101-110)
# - Floor 2: 10 rooms (201-210)
# - Floor 3: 8 rooms (301-308)
# - Floor 4: 5 rooms (401-405)

### 2.2. S∆° ƒë·ªì t·∫ßng 1 (Standard rooms)
GET {{baseUrl}}/api/rooms/map?floor=1
Authorization: Bearer {{receptionistToken}}

### Expected:
# - Single floor object with rooms 101-110

### 2.3. S∆° ƒë·ªì t·∫ßng 2 (Deluxe rooms)
GET {{baseUrl}}/api/rooms/map?floor=2
Authorization: Bearer {{managerToken}}

### Expected:
# - Rooms 201-210

### 2.4. S∆° ƒë·ªì t·∫ßng 3 (VIP rooms)
GET {{baseUrl}}/api/rooms/map?floor=3
Authorization: Bearer {{adminToken}}

### Expected:
# - Rooms 301-308

### 2.5. S∆° ƒë·ªì t·∫ßng 4 (Suite rooms)
GET {{baseUrl}}/api/rooms/map?floor=4
Authorization: Bearer {{managerToken}}

### Expected:
# - Rooms 401-405

###############################################
# 3. ROOM DETAILS (All roles)
###############################################

### 3.1. L·∫•y chi ti·∫øt ph√≤ng 101
GET {{baseUrl}}/api/rooms/1
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "data": {
#     "roomId": 1,
#     "roomName": "101",
#     "roomTypeId": 1,
#     "roomTypeName": "Ph√≤ng Ti√™u Chu·∫©n",
#     "roomTypeCode": "STD",
#     "basePriceNight": 800000,
#     "statusId": 1,
#     "status": "Tr·ªëng",
#     "statusCode": "Available",
#     "description": "Ph√≤ng Standard t·∫ßng 1...",
#     "maxOccupancy": 2,
#     "roomSize": 25,
#     "numberOfBeds": 1,
#     "bedType": "Queen",
#     "images": ["url1", "url2", "url3"],
#     "createdAt": "2024-...",
#     "updatedAt": null
#   }
# }
#
# ‚úÖ Validation:
# - All required fields present
# - basePriceNight should be 800000 (Standard room)
# - maxOccupancy should be 2
# - images array should have at least 1 image
# - statusCode should be valid enum value

### 3.2. L·∫•y chi ti·∫øt ph√≤ng kh√¥ng t·ªìn t·∫°i
GET {{baseUrl}}/api/rooms/99999
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 404 Not Found
# Body: {
#   "isSuccess": false,
#   "statusCode": 404,
#   "responseCode": "NOT_FOUND",
#   "message": "Kh√¥ng t√¨m th·∫•y ph√≤ng"
# }
#
# ‚úÖ Validation:
# - isSuccess must be false
# - statusCode must be 404
# - responseCode must be "NOT_FOUND"

###############################################
# 4. ROOM STATUS STATISTICS (All roles)
###############################################

### 4.1. L·∫•y th·ªëng k√™ tr·∫°ng th√°i ph√≤ng
GET {{baseUrl}}/api/rooms/stats
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "data": {
#     "totalRooms": 33,
#     "statusBreakdown": {
#       "Available": 17,
#       "Booked": 10,
#       "Occupied": 5,
#       "Cleaning": 1,
#       "Maintenance": 0,
#       "PendingInspection": 0,
#       "OutOfService": 0
#     },
#     "occupancyRate": 45.45,
#     "availableRooms": 17,
#     "occupiedRooms": 16
#   }
# }
#
# ‚úÖ Validation:
# - totalRooms should be 33
# - Sum of statusBreakdown values = totalRooms
# - occupancyRate = (occupiedRooms / totalRooms) * 100
# - availableRooms + occupiedRooms ‚â§ totalRooms

###############################################
# 5. AVAILABLE STATUS TRANSITIONS (All roles)
###############################################

### 5.1. [Admin] Xem tr·∫°ng th√°i c√≥ th·ªÉ chuy·ªÉn
GET {{baseUrl}}/api/rooms/1/available-status
Authorization: Bearer {{adminToken}}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "data": {
#     "currentStatus": {
#       "statusCode": "Available",
#       "statusName": "Tr·ªëng"
#     },
#     "availableTransitions": [
#       { "statusCode": "Booked", "statusName": "ƒê√£ ƒë·∫∑t", "description": "..." },
#       { "statusCode": "Occupied", "statusName": "ƒêang s·ª≠ d·ª•ng", "description": "..." },
#       { "statusCode": "Cleaning", "statusName": "ƒêang d·ªçn d·∫πp", "description": "..." },
#       { "statusCode": "Maintenance", "statusName": "B·∫£o tr√¨", "description": "..." },
#       { "statusCode": "PendingInspection", "statusName": "Ch·ªù ki·ªÉm tra", "description": "..." },
#       { "statusCode": "OutOfService", "statusName": "Ng·ª´ng ho·∫°t ƒë·ªông", "description": "..." }
#     ]
#   }
# }
#
# ‚úÖ Validation:
# - Admin should see ALL statuses except current (6 transitions)
# - currentStatus must match room's actual status
# - availableTransitions should not include current status

### 5.3. [Receptionist] Xem tr·∫°ng th√°i c√≥ th·ªÉ chuy·ªÉn
GET {{baseUrl}}/api/rooms/1/available-status
Authorization: Bearer {{receptionistToken}}

### Expected Response:
# Status: 200 OK
# Body: {
#   "data": {
#     "currentStatus": { "statusCode": "Available", ... },
#     "availableTransitions": [
#       { "statusCode": "Booked", "statusName": "ƒê√£ ƒë·∫∑t" },
#       { "statusCode": "Occupied", "statusName": "ƒêang s·ª≠ d·ª•ng" }
#     ]
#   }
# }
#
# ‚úÖ Validation:
# - Receptionist from Available should ONLY see: Booked, Occupied
# - Should NOT see: Cleaning, Maintenance, PendingInspection
# - Array length should be 2

###############################################
# 6. RECEPTIONIST - STATUS CHANGES
###############################################

### 6.1. [Receptionist] Available ‚Üí Booked (‚úÖ Allowed)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "Booked"
}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "ƒê√£ chuy·ªÉn tr·∫°ng th√°i ph√≤ng 101 th√†nh 'ƒê√£ ƒë·∫∑t'"
# }
#
# ‚úÖ Validation:
# - isSuccess must be true
# - statusCode must be 200
# - message contains room name "101" and new status "ƒê√£ ƒë·∫∑t"
#
# ‚úÖ Follow-up Check - Verify status changed:
GET {{baseUrl}}/api/rooms/1
Authorization: Bearer {{receptionistToken}}
# Should return: statusCode = "Booked", status = "ƒê√£ ƒë·∫∑t"

### 6.2. [Receptionist] Booked ‚Üí Occupied (‚úÖ Allowed)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "Occupied"
}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "ƒê√£ chuy·ªÉn tr·∫°ng th√°i ph√≤ng 101 th√†nh 'ƒêang s·ª≠ d·ª•ng'"
# }
#
# ‚úÖ Validation:
# - isSuccess must be true
# - statusCode must be 200
# - message contains room name "101" and new status "ƒêang s·ª≠ d·ª•ng"
#
# ‚úÖ Follow-up Check - Verify status changed:
GET {{baseUrl}}/api/rooms/1
Authorization: Bearer {{receptionistToken}}
# Should return: statusCode = "Occupied", status = "ƒêang s·ª≠ d·ª•ng"

### 6.3. [Receptionist] Occupied ‚Üí Available (‚úÖ Allowed - Check-out)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "Available"
}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "ƒê√£ chuy·ªÉn tr·∫°ng th√°i ph√≤ng 101 th√†nh 'Tr·ªëng'"
# }
#
# ‚úÖ Validation:
# - isSuccess must be true
# - statusCode must be 200
# - message contains room name "101" and new status "Tr·ªëng"
#
# ‚úÖ Follow-up Check - Verify status changed:
GET {{baseUrl}}/api/rooms/1
Authorization: Bearer {{receptionistToken}}
# Should return: statusCode = "Available", status = "Tr·ªëng"

### 6.4. [Receptionist] Available ‚Üí Cleaning (‚ùå FORBIDDEN)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "Cleaning"
}

### Expected Response:
# Status: 403 Forbidden
# Body: {
#   "isSuccess": false,
#   "statusCode": 403,
#   "responseCode": "FORBIDDEN",
#   "message": "Role Receptionist kh√¥ng c√≥ quy·ªÅn chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i n√†y"
# }
#
# ‚úÖ Validation:
# - isSuccess must be false
# - statusCode must be 403
# - responseCode must be "FORBIDDEN"
# - message mentions "kh√¥ng c√≥ quy·ªÅn"
#
# ‚úÖ Follow-up Check - Verify status NOT changed:
GET {{baseUrl}}/api/rooms/1
Authorization: Bearer {{receptionistToken}}
# Should still be: statusCode = "Available" (unchanged)

### 6.5. [Receptionist] Available ‚Üí Maintenance (‚ùå FORBIDDEN)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "Maintenance"
}

### Expected Response:
# Status: 403 Forbidden
# Body: {
#   "isSuccess": false,
#   "statusCode": 403,
#   "responseCode": "FORBIDDEN",
#   "message": "Role Receptionist kh√¥ng c√≥ quy·ªÅn chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i n√†y"
# }
#
# ‚úÖ Validation:
# - isSuccess must be false
# - statusCode must be 403
# - responseCode must be "FORBIDDEN"
# - message mentions "kh√¥ng c√≥ quy·ªÅn"

###############################################
# 7. HOUSEKEEPER - CLEANING WORKFLOW
###############################################

### 7.1. [Manager] Setup: ƒê∆∞a ph√≤ng v·ªÅ Available tr∆∞·ªõc
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 2,
  "newStatus": "Available"
}

### 7.2. [Housekeeper] B·∫Øt ƒë·∫ßu d·ªçn ph√≤ng (Available ‚Üí Cleaning)
POST {{baseUrl}}/api/rooms/2/start-cleaning
Authorization: Bearer {{housekeeperToken}}

### Expected:
# - Status: 200 OK
# - Room 102 chuy·ªÉn sang "ƒêang d·ªçn d·∫πp"

### 7.3. [Housekeeper] Ho√†n t·∫•t d·ªçn ph√≤ng (Cleaning ‚Üí Available)
POST {{baseUrl}}/api/rooms/2/complete-cleaning
Authorization: Bearer {{housekeeperToken}}

### Expected:
# - Status: 200 OK
# - Room 102 tr·ªü l·∫°i "Tr·ªëng"

### 7.4. [Housekeeper] D·ªçn ph√≤ng Occupied ‚Üí Cleaning
# Setup: ƒê∆∞a ph√≤ng v·ªÅ Occupied
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 3,
  "newStatus": "Occupied"
}

###
POST {{baseUrl}}/api/rooms/3/start-cleaning
Authorization: Bearer {{housekeeperToken}}

### Expected:
# - Status: 200 OK
# - Room 103 t·ª´ "ƒêang s·ª≠ d·ª•ng" ‚Üí "ƒêang d·ªçn d·∫πp"

### 7.5. [Housekeeper] Cleaning ‚Üí PendingInspection (‚úÖ Allowed)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{housekeeperToken}}
Content-Type: application/json

{
  "roomId": 3,
  "newStatus": "PendingInspection"
}

### Expected:
# - Status: 200 OK
# - Room 103 ‚Üí "Ch·ªù ki·ªÉm tra"

### 7.6. [Housekeeper] PendingInspection ‚Üí Available (‚úÖ Allowed)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{housekeeperToken}}
Content-Type: application/json

{
  "roomId": 3,
  "newStatus": "Available"
}

### Expected:
# - Status: 200 OK
# - Room 103 ‚Üí "Tr·ªëng"

### 7.7. [Housekeeper] Available ‚Üí Maintenance (‚ùå FORBIDDEN)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{housekeeperToken}}
Content-Type: application/json

{
  "roomId": 3,
  "newStatus": "Maintenance"
}

### Expected:
# - Status: 403 Forbidden
# - Housekeeper kh√¥ng ƒë∆∞·ª£c ph√©p b·∫£o tr√¨

###############################################
# 8. TECHNICIAN - MAINTENANCE WORKFLOW
###############################################

### 8.1. [Technician] ƒê√°nh d·∫•u ph√≤ng c·∫ßn b·∫£o tr√¨ (Available ‚Üí Maintenance)
POST {{baseUrl}}/api/rooms/4/start-maintenance
Authorization: Bearer {{technicianToken}}
Content-Type: application/json

"S·ª≠a ƒëi·ªÅu h√≤a b·ªã h·ªèng"

### Expected:
# - Status: 200 OK
# - Room 104 ‚Üí "B·∫£o tr√¨"

### 8.2. [Technician] Ho√†n t·∫•t b·∫£o tr√¨ (Maintenance ‚Üí Available)
POST {{baseUrl}}/api/rooms/4/complete-maintenance
Authorization: Bearer {{technicianToken}}

### Expected:
# - Status: 200 OK
# - Room 104 ‚Üí "Tr·ªëng"

### 8.3. [Technician] B·∫£o tr√¨ ph√≤ng ƒëang Occupied
# Setup
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 5,
  "newStatus": "Occupied"
}

###
POST {{baseUrl}}/api/rooms/5/start-maintenance
Authorization: Bearer {{technicianToken}}
Content-Type: application/json

"Kh·∫©n c·∫•p: R√≤ r·ªâ n∆∞·ªõc"

### Expected:
# - Status: 200 OK
# - Room 105 t·ª´ "ƒêang s·ª≠ d·ª•ng" ‚Üí "B·∫£o tr√¨"

### 8.4. [Technician] Kh√¥ng th·ªÉ chuy·ªÉn Maintenance ‚Üí Cleaning (‚ùå Limited)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{technicianToken}}
Content-Type: application/json

{
  "roomId": 5,
  "newStatus": "Cleaning"
}

### Expected:
# - Status: 403 Forbidden
# - Technician ch·ªâ c√≥ th·ªÉ: Any ‚Üí Maintenance, Maintenance ‚Üí Available

###############################################
# 9. MANAGER - FULL CONTROL
###############################################

### 9.1. [Manager] Available ‚Üí Booked
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 6,
  "newStatus": "Booked"
}

### 9.2. [Manager] Booked ‚Üí Occupied
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 6,
  "newStatus": "Occupied"
}

### 9.3. [Manager] Occupied ‚Üí Cleaning
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 6,
  "newStatus": "Cleaning"
}

### 9.4. [Manager] Cleaning ‚Üí Maintenance
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 6,
  "newStatus": "Maintenance"
}

### 9.5. [Manager] Maintenance ‚Üí Available
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 6,
  "newStatus": "Available"
}

### 9.6. [Manager] Available ‚Üí OutOfService
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 6,
  "newStatus": "OutOfService"
}

### Expected:
# - All transitions: ‚úÖ SUCCESS
# - Manager c√≥ full quy·ªÅn chuy·ªÉn ƒë·ªïi m·ªçi tr·∫°ng th√°i

###############################################
# 10. BULK STATUS CHANGE (Manager/Admin only)
###############################################

### 10.1. [Manager] Thay ƒë·ªïi nhi·ªÅu ph√≤ng c√πng l√∫c
PATCH {{baseUrl}}/api/rooms/bulk-status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomIds": [7, 8, 9],
  "newStatus": "Cleaning"
}

### Expected Response:
# Status: 200 OK
# Body: {
#   "isSuccess": true,
#   "statusCode": 200,
#   "message": "ƒê√£ chuy·ªÉn tr·∫°ng th√°i 3 ph√≤ng th√†nh c√¥ng",
#   "data": {
#     "successCount": 3,
#     "failedRooms": []
#   }
# }
#
# ‚úÖ Validation:
# - isSuccess must be true
# - data.successCount should be 3
# - data.failedRooms should be empty array
#
# ‚úÖ Follow-up Check - Verify all rooms changed:
GET {{baseUrl}}/api/rooms/7
GET {{baseUrl}}/api/rooms/8
GET {{baseUrl}}/api/rooms/9
# All should return: statusCode = "Cleaning"

### 10.2. [Manager] Bulk change v·ªÅ Available
PATCH {{baseUrl}}/api/rooms/bulk-status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomIds": [7, 8, 9],
  "newStatus": "Available"
}

### 10.3. [Receptionist] Bulk change (‚ùå FORBIDDEN)
PATCH {{baseUrl}}/api/rooms/bulk-status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomIds": [10, 11],
  "newStatus": "Booked"
}

### Expected Response:
# Status: 403 Forbidden
# Body: {
#   "isSuccess": false,
#   "statusCode": 403,
#   "responseCode": "FORBIDDEN",
#   "message": "B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán thao t√°c n√†y"
# }
#
# ‚úÖ Validation:
# - This should fail at controller level ([Authorize(Roles = "Admin,Manager")])
# - Even before reaching service logic

###############################################
# 11. EDGE CASES & ERROR HANDLING
###############################################

### 11.1. Chuy·ªÉn tr·∫°ng th√°i ph√≤ng kh√¥ng t·ªìn t·∫°i
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 99999,
  "newStatus": "Available"
}

### Expected:
# - Status: 404 Not Found

### 11.2. Chuy·ªÉn sang tr·∫°ng th√°i kh√¥ng h·ª£p l·ªá
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "InvalidStatus"
}

### Expected:
# - Status: 400 Bad Request

### 11.3. Chuy·ªÉn sang c√πng tr·∫°ng th√°i hi·ªán t·∫°i
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 1,
  "newStatus": "Available"
}

### Expected:
# - C√≥ th·ªÉ 200 OK ho·∫∑c 400 Bad Request (t√πy logic)

### 11.4. Kh√¥ng c√≥ token (‚ùå Unauthorized)
GET {{baseUrl}}/api/rooms/search

### Expected:
# - Status: 401 Unauthorized

### 11.5. Token h·∫øt h·∫°n
GET {{baseUrl}}/api/rooms/search
Authorization: Bearer expired_token_here

### Expected:
# - Status: 401 Unauthorized

###############################################
# 12. STATUS TRANSITION MATRIX TEST
###############################################

### TEST MATRIX: Receptionist Permissions
# Available ‚Üí Booked: ‚úÖ
# Available ‚Üí Occupied: ‚úÖ
# Available ‚Üí Cleaning: ‚ùå
# Available ‚Üí Maintenance: ‚ùå
# Booked ‚Üí Available: ‚úÖ
# Booked ‚Üí Occupied: ‚úÖ
# Booked ‚Üí Cleaning: ‚ùå
# Occupied ‚Üí Available: ‚úÖ
# Occupied ‚Üí Cleaning: ‚ùå
# Cleaning ‚Üí Available: ‚ùå
# Maintenance ‚Üí Available: ‚ùå

### 12.1. [Receptionist] Available ‚Üí Booked (‚úÖ)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 10,
  "newStatus": "Booked"
}

### 12.2. [Receptionist] Booked ‚Üí Occupied (‚úÖ)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 10,
  "newStatus": "Occupied"
}

### 12.3. [Receptionist] Occupied ‚Üí Available (‚úÖ)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 10,
  "newStatus": "Available"
}

###############################################
# 13. CONCURRENT STATUS CHANGES (Race Condition Test)
###############################################

### 13.1. User 1: Manager changes room 11 to Cleaning
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
  "roomId": 11,
  "newStatus": "Cleaning"
}

### 13.2. User 2: Receptionist tries to book room 11 (should fail if Cleaning)
PATCH {{baseUrl}}/api/rooms/status
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "roomId": 11,
  "newStatus": "Booked"
}

### Expected:
# - Status: 403 Forbidden
# - Receptionist cannot change from Cleaning

###############################################
# 14. WORKFLOW SCENARIOS
###############################################

### Scenario 1: Complete Booking Flow
# 1. Receptionist: Available ‚Üí Booked (ƒê·∫∑t ph√≤ng)
# 2. Receptionist: Booked ‚Üí Occupied (Check-in)
# 3. Receptionist: Occupied ‚Üí Available (Check-out)
# 4. Housekeeper: Available ‚Üí Cleaning (D·ªçn ph√≤ng)
# 5. Housekeeper: Cleaning ‚Üí Available (Ho√†n t·∫•t)

### Scenario 2: Maintenance Flow
# 1. Technician: Available ‚Üí Maintenance (Ph√°t hi·ªán h·ªèng h√≥c)
# 2. Technician: Fix the issue
# 3. Technician: Maintenance ‚Üí Available (Ho√†n t·∫•t b·∫£o tr√¨)
# 4. Housekeeper: Available ‚Üí Cleaning (D·ªçn s·∫°ch sau b·∫£o tr√¨)
# 5. Housekeeper: Cleaning ‚Üí Available (S·∫µn s√†ng cho kh√°ch)

### Scenario 3: Emergency Maintenance During Occupancy
# 1. Manager: Occupied ‚Üí Maintenance (Kh·∫©n c·∫•p)
# 2. Technician: Fix critical issue
# 3. Manager: Maintenance ‚Üí Available
# 4. Housekeeper: Available ‚Üí Cleaning
# 5. Housekeeper: Cleaning ‚Üí Available

###############################################
# 15. SUMMARY & VALIDATION CHECKLIST
###############################################

### ‚úÖ COMPLETED TESTS:
# - Room search & filtering (by name, type, status, floor)
# - Room map visualization (all floors, specific floor)
# - Room details & stats
# - Available status transitions (per role)
# - Receptionist permissions (Available ‚Üî Booked ‚Üî Occupied)
# - Housekeeper workflow (Cleaning flow)
# - Technician workflow (Maintenance flow)
# - Manager full control (all transitions)
# - Bulk status changes
# - Edge cases & error handling
# - Status transition matrix
# - Role-based authorization

### üìä STATUS TRANSITION RULES:
# Admin/Manager: ALL transitions allowed
# Receptionist: Available ‚Üî Booked ‚Üî Occupied only
# Housekeeper: Available/Occupied ‚Üí Cleaning ‚Üí Available/PendingInspection
# Technician: Any ‚Üí Maintenance, Maintenance ‚Üí Available

### üîç VALIDATION POINTS:
# ‚úì All roles can search/view rooms
# ‚úì Only authorized roles can change status
# ‚úì Status transitions follow business rules
# ‚úì Bulk operations require Manager/Admin
# ‚úì Error handling for invalid inputs
# ‚úì Concurrent access control

### END OF TEST CASES ###
