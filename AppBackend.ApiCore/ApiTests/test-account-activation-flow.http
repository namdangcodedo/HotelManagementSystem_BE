### ===================================
### ACCOUNT ACTIVATION FLOW - API TESTS
### ===================================
### 
### Lu·ªìng k√≠ch ho·∫°t t√†i kho·∫£n:
### 1. ƒêƒÉng k√Ω t√†i kho·∫£n ‚Üí Nh·∫≠n email k√≠ch ho·∫°t
### 2. Click link trong email ‚Üí K√≠ch ho·∫°t t√†i kho·∫£n
### 3. T·ª± ƒë·ªông ƒëƒÉng nh·∫≠p sau khi k√≠ch ho·∫°t
### 4. N·∫øu link h·∫øt h·∫°n ‚Üí G·ª≠i l·∫°i email k√≠ch ho·∫°t
###
### Base URL: http://localhost:8080
### Frontend URL: http://localhost:3000
### ===================================

@baseUrl = http://localhost:8080
@frontendUrl = http://localhost:3000

### ===================================
### B∆Ø·ªöC 1: ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi
### ===================================
### Response s·∫Ω ch·ª©a:
### - accountId
### - email
### - message: "Email k√≠ch ho·∫°t ƒë√£ ƒë∆∞·ª£c g·ª≠i"
###
### ‚ö†Ô∏è T√†i kho·∫£n s·∫Ω ·ªü tr·∫°ng th√°i IsLocked = true
### ‚ö†Ô∏è Email k√≠ch ho·∫°t c√≥ hi·ªáu l·ª±c 5 ph√∫t

POST {{baseUrl}}/api/Authentication/register
Content-Type: application/json

{
  "username": "testuser123",
  "email": "testuser123@example.com",
  "password": "Test@123456",
  "fullName": "Nguy·ªÖn VƒÉn Test",
  "phoneNumber": "0987654321",
  "identityCard": "123456789",
  "address": "123 Test Street, Hanoi"
}

### ===================================
### B∆Ø·ªöC 2: Ki·ªÉm tra email v√† l·∫•y token
### ===================================
### Email s·∫Ω c√≥ link d·∫°ng:
### {{frontendUrl}}/activate-account/{TOKEN}
###
### VD: http://localhost:3000/activate-account/abc123xyz
###
### üìß M·ªü email v√† copy token t·ª´ link

@activationToken = PASTE_TOKEN_FROM_EMAIL_HERE

### ===================================
### B∆Ø·ªöC 3: K√≠ch ho·∫°t t√†i kho·∫£n b·∫±ng token
### ===================================
### Response s·∫Ω tr·∫£ v·ªÅ:
### - email, username
### - token (access token) ‚úÖ
### - refreshToken ‚úÖ
### - roles
###
### ‚ú® Frontend c√≥ th·ªÉ l∆∞u token v√† auto-login!

GET {{baseUrl}}/api/Authentication/activate-account/{{activationToken}}

### Response Example (Success):
### {
###   "isSuccess": true,
###   "message": "K√≠ch ho·∫°t t√†i kho·∫£n th√†nh c√¥ng! ƒêang t·ª± ƒë·ªông ƒëƒÉng nh·∫≠p...",
###   "data": {
###     "email": "testuser123@example.com",
###     "username": "testuser123",
###     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
###     "refreshToken": "abc123xyz...",
###     "roles": ["User"]
###   },
###   "statusCode": 200
### }

### ===================================
### B∆Ø·ªöC 4A: Test khi link ƒë√£ h·∫øt h·∫°n (> 5 ph√∫t)
### ===================================
### ƒê·ª£i 5 ph√∫t r·ªìi g·ªçi l·∫°i API activate-account

GET {{baseUrl}}/api/Authentication/activate-account/{{activationToken}}

### Response Example (Expired):
### {
###   "isSuccess": false,
###   "message": "Link k√≠ch ho·∫°t ƒë√£ h·∫øt h·∫°n (qu√° 5 ph√∫t). Vui l√≤ng g·ª≠i l·∫°i email k√≠ch ho·∫°t.",
###   "statusCode": 400
### }

### ===================================
### B∆Ø·ªöC 4B: G·ª≠i l·∫°i email k√≠ch ho·∫°t
### ===================================
### D√πng khi:
### - Link ƒë√£ h·∫øt h·∫°n
### - Kh√¥ng nh·∫≠n ƒë∆∞·ª£c email
### - Email b·ªã x√≥a nh·∫ßm

POST {{baseUrl}}/api/Authentication/resend-activation-email
Content-Type: application/json

{
  "email": "testuser123@example.com"
}

### Response Example (Success):
### {
###   "isSuccess": true,
###   "message": "Email k√≠ch ho·∫°t ƒë√£ ƒë∆∞·ª£c g·ª≠i l·∫°i! Vui l√≤ng ki·ªÉm tra email v√† k√≠ch ho·∫°t trong v√≤ng 5 ph√∫t.",
###   "data": {
###     "email": "testuser123@example.com",
###     "message": "Link k√≠ch ho·∫°t m·ªõi c√≥ hi·ªáu l·ª±c trong 5 ph√∫t"
###   }
### }

### Sau khi nh·∫≠n email m·ªõi, quay l·∫°i B∆Ø·ªöC 2 ƒë·ªÉ l·∫•y token m·ªõi

### ===================================
### B∆Ø·ªöC 5: Test ƒëƒÉng nh·∫≠p b√¨nh th∆∞·ªùng (sau khi k√≠ch ho·∫°t)
### ===================================

POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "testuser123@example.com",
  "password": "Test@123456"
}

### Response s·∫Ω gi·ªëng nh∆∞ response c·ªßa activate-account:
### {
###   "isSuccess": true,
###   "message": "ƒêƒÉng nh·∫≠p th√†nh c√¥ng",
###   "data": {
###     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
###     "refreshToken": "abc123xyz...",
###     "roles": ["User"]
###   }
### }

### ===================================
### ERROR CASES - Test c√°c tr∆∞·ªùng h·ª£p l·ªói
### ===================================

### Test 1: Token kh√¥ng h·ª£p l·ªá
GET {{baseUrl}}/api/Authentication/activate-account/invalid-token-123

### Test 2: Email kh√¥ng t·ªìn t·∫°i khi resend
POST {{baseUrl}}/api/Authentication/resend-activation-email
Content-Type: application/json

{
  "email": "notexist@example.com"
}

### Test 3: T√†i kho·∫£n ƒë√£ k√≠ch ho·∫°t r·ªìi (g·ªçi activate l·∫ßn 2)
GET {{baseUrl}}/api/Authentication/activate-account/{{activationToken}}

### Test 4: G·ª≠i l·∫°i email cho t√†i kho·∫£n ƒë√£ active
POST {{baseUrl}}/api/Authentication/resend-activation-email
Content-Type: application/json

{
  "email": "testuser123@example.com"
}

### Test 5: ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n ch∆∞a k√≠ch ho·∫°t
POST {{baseUrl}}/api/Authentication/login
Content-Type: application/json

{
  "email": "inactive@example.com",
  "password": "Test@123456"
}

### Response: "T√†i kho·∫£n ƒë√£ b·ªã kho√°"

### ===================================
### PROTECTED API - Test v·ªõi token sau khi k√≠ch ho·∫°t
### ===================================

@accessToken = PASTE_ACCESS_TOKEN_HERE

### Test access protected endpoint
GET {{baseUrl}}/api/Booking/my-bookings
Authorization: Bearer {{accessToken}}

### ===================================
### NOTES FOR FRONTEND
### ===================================
### 
### 1. Sau khi user ƒëƒÉng k√Ω:
###    - Hi·ªÉn th·ªã: "Vui l√≤ng check email ƒë·ªÉ k√≠ch ho·∫°t t√†i kho·∫£n"
###    - C√≥ n√∫t "G·ª≠i l·∫°i email" n·∫øu ch∆∞a nh·∫≠n ƒë∆∞·ª£c
###
### 2. Khi user click link trong email:
###    - Parse token t·ª´ URL: /activate-account/{token}
###    - G·ªçi: GET /api/Authentication/activate-account/{token}
###    - L∆∞u token + refreshToken v√†o localStorage
###    - Redirect v·ªÅ trang ch·ªß (ƒë√£ ƒëƒÉng nh·∫≠p)
###
### 3. X·ª≠ l√Ω l·ªói:
###    - N·∫øu "Link ƒë√£ h·∫øt h·∫°n" ‚Üí Hi·ªÉn th·ªã form nh·∫≠p email
###    - G·ªçi: POST /api/Authentication/resend-activation-email
###    - Th√¥ng b√°o: "Email m·ªõi ƒë√£ ƒë∆∞·ª£c g·ª≠i"
###
### 4. Auto-login sau activation:
###    - Response c√≥ token v√† refreshToken
###    - Kh√¥ng c·∫ßn g·ªçi API login n·ªØa
###    - L∆∞u token v√† redirect v·ªÅ dashboard
### ===================================

