### Test Booking API with Holiday Pricing
### Author: Hotel Management Team
### Date: 2025-01-19
### Compatible with: IntelliJ HTTP Client & VS Code REST Client

# Variables
@baseUrl = http://localhost:8080/api
@testCustomerId = 1
@testBookingId = 1

### ===== AUTHENTICATION =====

### 1. ÄÄƒng nháº­p Admin Ä‘á»ƒ láº¥y token
POST {{baseUrl}}/Authentication/login
Content-Type: application/json

{
  "email": "admin@hotel.com",
  "password": "Admin@123"
}

> {%
    client.global.set("auth_token", response.body.data.token);
    client.global.set("admin_token", response.body.data.token);
%}

### 2. ÄÄƒng nháº­p Manager Ä‘á»ƒ láº¥y token  
POST {{baseUrl}}/Authentication/login
Content-Type: application/json

{
  "email": "manager@hotel.com",
  "password": "Manager@123"
}

> {%
    client.global.set("manager_token", response.body.data.token);
%}

### 3. ÄÄƒng kÃ½/ÄÄƒng nháº­p Customer Ä‘á»ƒ láº¥y token
POST {{baseUrl}}/Authentication/register
Content-Type: application/json

{
  "username": "customer_booking",
  "email": "customer_booking@example.com",
  "password": "Customer@123",
  "fullName": "Nguyá»…n VÄƒn KhÃ¡ch HÃ ng",
  "phoneNumber": "0912345678",
  "identityCard": "001234567890",
  "address": "123 LÃª Lá»£i, Q1, TP.HCM"
}

> {%
    client.global.set("customer_token", response.body.data.token);
    client.global.set("customer_id", response.body.data.customerId || 1);
%}

### ===== PREREQUISITE: GET COMMON CODES =====

### 4. Láº¥y danh sÃ¡ch RoomStatus codes
GET {{baseUrl}}/CommonCode/type/RoomStatus

### 5. Láº¥y danh sÃ¡ch PaymentStatus codes
GET {{baseUrl}}/CommonCode/type/PaymentStatus

### 6. Láº¥y danh sÃ¡ch BookingType codes
GET {{baseUrl}}/CommonCode/type/BookingType

### ===== ROOM INFORMATION =====

### 7. Xem thÃ´ng tin Room 101 (Standard - 800k/Ä‘Ãªm)
GET {{baseUrl}}/Room/1

### 8. Xem thÃ´ng tin Room 102 (Standard - 800k/Ä‘Ãªm)
GET {{baseUrl}}/Room/2

### 9. Xem thÃ´ng tin Room 201 (Deluxe - 1,500k/Ä‘Ãªm)
GET {{baseUrl}}/Room/3

### ===== PUBLIC: CHECK AVAILABILITY =====

### 10. Kiá»ƒm tra phÃ²ng available trong ngÃ y thÆ°á»ng (Public - khÃ´ng cáº§n token)
POST {{baseUrl}}/Booking/check-availability
Content-Type: application/json

{
  "roomIds": [1, 2],
  "checkInDate": "2025-03-15T14:00:00",
  "checkOutDate": "2025-03-17T12:00:00"
}

### ===== TEST CASE 1: BOOKING NGÃ€Y THÆ¯á»œNG (KHÃ”NG CÃ“ HOLIDAY PRICING) =====

### 11. Táº¡o booking ngÃ y thÆ°á»ng (2 Ä‘Ãªm)
# Expected Result:
# - Room 101: 800,000 Ã— 2 = 1,600,000 VNÄ
# - Room 102: 800,000 Ã— 2 = 1,600,000 VNÄ
# - Total: 3,200,000 VNÄ
# - Deposit (30%): 960,000 VNÄ
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1, 2],
  "checkInDate": "2025-03-15T14:00:00",
  "checkOutDate": "2025-03-17T12:00:00",
  "bookingType": "Online",
  "specialRequests": "Test booking - ngÃ y thÆ°á»ng"
}

> {%
    client.global.set("booking_normal_id", response.body.data.bookingId);
%}

### ===== TEST CASE 2: BOOKING Dá»ŠP Táº¾T NGUYÃŠN ÄÃN (28/01 - 03/02/2025) =====

### 12. Xem thÃ´ng tin Holiday Táº¿t NguyÃªn ÄÃ¡n
GET {{baseUrl}}/Holiday/1

### 13. Kiá»ƒm tra phÃ²ng available trong dá»‹p Táº¿t
POST {{baseUrl}}/Booking/check-availability
Content-Type: application/json

{
  "roomIds": [1, 3],
  "checkInDate": "2025-01-28T14:00:00",
  "checkOutDate": "2025-01-30T12:00:00"
}

### 14. Táº¡o booking trong dá»‹p Táº¿t (2 Ä‘Ãªm)
# Expected Result with Holiday Pricing:
# - Room 101: (800,000 + 300,000) Ã— 2 = 2,200,000 VNÄ
# - Room 201: (1,500,000 + 500,000) Ã— 2 = 4,000,000 VNÄ
# - Total: 6,200,000 VNÄ
# - Deposit (30%): 1,860,000 VNÄ
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1, 3],
  "checkInDate": "2025-01-28T14:00:00",
  "checkOutDate": "2025-01-30T12:00:00",
  "bookingType": "Online",
  "specialRequests": "Test booking - dá»‹p Táº¿t NguyÃªn ÄÃ¡n"
}

> {%
    client.global.set("booking_tet_id", response.body.data.bookingId);
%}

### ===== TEST CASE 3: BOOKING Lá»„ 30/4 - 1/5 (30/04 - 03/05/2025) =====

### 15. Kiá»ƒm tra phÃ²ng available trong dá»‹p lá»… 30/4
POST {{baseUrl}}/Booking/check-availability
Content-Type: application/json

{
  "roomIds": [1, 2],
  "checkInDate": "2025-04-30T14:00:00",
  "checkOutDate": "2025-05-02T12:00:00"
}

### 16. Táº¡o booking trong dá»‹p lá»… 30/4 (2 Ä‘Ãªm)
# Expected Result with Holiday Pricing:
# - Room 101: (800,000 + 200,000) Ã— 2 = 2,000,000 VNÄ
# - Room 102: (800,000 + 200,000) Ã— 2 = 2,000,000 VNÄ
# - Total: 4,000,000 VNÄ
# - Deposit (30%): 1,200,000 VNÄ
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1, 2],
  "checkInDate": "2025-04-30T14:00:00",
  "checkOutDate": "2025-05-02T12:00:00",
  "bookingType": "Online",
  "specialRequests": "Test booking - dá»‹p lá»… 30/4 - 1/5"
}

> {%
    client.global.set("booking_labor_id", response.body.data.bookingId);
%}

### ===== TEST CASE 4: BOOKING QUá»C KHÃNH 2/9 (01/09 - 03/09/2025) =====

### 17. Táº¡o booking trong dá»‹p Quá»‘c KhÃ¡nh (2 Ä‘Ãªm)
# Expected Result with Holiday Pricing:
# - Room 102: (800,000 + 200,000) Ã— 2 = 2,000,000 VNÄ
# - Room 201: (1,500,000 + 300,000) Ã— 2 = 3,600,000 VNÄ
# - Total: 5,600,000 VNÄ
# - Deposit (30%): 1,680,000 VNÄ
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [2, 3],
  "checkInDate": "2025-09-01T14:00:00",
  "checkOutDate": "2025-09-03T12:00:00",
  "bookingType": "Online",
  "specialRequests": "Test booking - dá»‹p Quá»‘c KhÃ¡nh 2/9"
}

> {%
    client.global.set("booking_national_id", response.body.data.bookingId);
%}

### ===== TEST CASE 5: BOOKING SPAN ACROSS HOLIDAY =====

### 18. Táº¡o booking tá»« trÆ°á»›c Táº¿t Ä‘áº¿n trong Táº¿t (3 Ä‘Ãªm)
# Expected Result:
# - ÄÃªm 1 (27/01): 800,000 VNÄ (giÃ¡ thÆ°á»ng)
# - ÄÃªm 2 (28/01): 1,100,000 VNÄ (giÃ¡ Táº¿t)
# - ÄÃªm 3 (29/01): 1,100,000 VNÄ (giÃ¡ Táº¿t)
# - Total: 3,000,000 VNÄ
# - Deposit (30%): 900,000 VNÄ
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1],
  "checkInDate": "2025-01-27T14:00:00",
  "checkOutDate": "2025-01-30T12:00:00",
  "bookingType": "Online",
  "specialRequests": "Test booking - span across Táº¿t holiday"
}

> {%
    client.global.set("booking_span_id", response.body.data.bookingId);
%}

### ===== VIEW BOOKING DETAILS =====

### 19. Xem chi tiáº¿t booking cá»§a mÃ¬nh (Customer)
GET {{baseUrl}}/Booking/{{booking_normal_id}}
Authorization: Bearer {{customer_token}}

### 20. Admin xem chi tiáº¿t booking
GET {{baseUrl}}/Booking/{{booking_tet_id}}
Authorization: Bearer {{admin_token}}

### 21. Manager xem chi tiáº¿t booking
GET {{baseUrl}}/Booking/{{booking_labor_id}}
Authorization: Bearer {{manager_token}}

### 22. Customer xem danh sÃ¡ch booking cá»§a mÃ¬nh
GET {{baseUrl}}/Booking/my-bookings
Authorization: Bearer {{customer_token}}

### ===== PAYMENT FLOW =====

### 23. XÃ¡c nháº­n thanh toÃ¡n booking (sau khi thanh toÃ¡n qua PayOS)
POST {{baseUrl}}/Booking/confirm-payment
Content-Type: application/json

{
  "bookingId": {{booking_normal_id}},
  "orderCode": "251019143000"
}

### 24. Kiá»ƒm tra transaction cá»§a booking
GET {{baseUrl}}/Transaction/booking/{{booking_normal_id}}
Authorization: Bearer {{customer_token}}

### ===== CANCEL BOOKING =====

### 25. Customer há»§y booking cá»§a mÃ¬nh
DELETE {{baseUrl}}/Booking/{{booking_span_id}}
Authorization: Bearer {{customer_token}}

### 26. Admin há»§y booking (admin power)
DELETE {{baseUrl}}/Booking/{{booking_labor_id}}
Authorization: Bearer {{admin_token}}

### ===== ERROR CASES: FORBIDDEN (403) =====

### 27. Customer cá»‘ xem booking cá»§a ngÆ°á»i khÃ¡c (sáº½ lá»—i 403)
GET {{baseUrl}}/Booking/1
Authorization: Bearer {{customer_token}}

### 28. Customer cá»‘ há»§y booking cá»§a ngÆ°á»i khÃ¡c (sáº½ lá»—i 403)
DELETE {{baseUrl}}/Booking/1
Authorization: Bearer {{customer_token}}

### ===== ERROR CASES: NOT FOUND (404) =====

### 29. Xem booking khÃ´ng tá»“n táº¡i
GET {{baseUrl}}/Booking/99999
Authorization: Bearer {{customer_token}}

### 30. Há»§y booking khÃ´ng tá»“n táº¡i
DELETE {{baseUrl}}/Booking/99999
Authorization: Bearer {{admin_token}}

### ===== ERROR CASES: CONFLICT (409) =====

### 31. Táº¡o booking vá»›i phÃ²ng Ä‘Ã£ bá»‹ Ä‘áº·t (conflict)
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1],
  "checkInDate": "2025-03-15T14:00:00",
  "checkOutDate": "2025-03-17T12:00:00",
  "bookingType": "Online"
}

### 32. Check availability cho phÃ²ng Ä‘Ã£ booked
POST {{baseUrl}}/Booking/check-availability
Content-Type: application/json

{
  "roomIds": [1, 2],
  "checkInDate": "2025-03-15T14:00:00",
  "checkOutDate": "2025-03-17T12:00:00"
}

### ===== ERROR CASES: BAD REQUEST (400) =====

### 33. Táº¡o booking vá»›i checkOut trÆ°á»›c checkIn (invalid dates)
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1],
  "checkInDate": "2025-03-17T14:00:00",
  "checkOutDate": "2025-03-15T12:00:00",
  "bookingType": "Online"
}

### 34. Táº¡o booking vá»›i customerId khÃ´ng tá»“n táº¡i
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 99999,
  "roomIds": [1],
  "checkInDate": "2025-03-15T14:00:00",
  "checkOutDate": "2025-03-17T12:00:00",
  "bookingType": "Online"
}

### ===== ERROR CASES: UNAUTHORIZED (401) =====

### 35. Táº¡o booking khÃ´ng cÃ³ token (sáº½ lá»—i 401)
POST {{baseUrl}}/Booking
Content-Type: application/json

{
  "customerId": 1,
  "roomIds": [1],
  "checkInDate": "2025-03-15T14:00:00",
  "checkOutDate": "2025-03-17T12:00:00",
  "bookingType": "Online"
}

### 36. Xem booking khÃ´ng cÃ³ token (sáº½ lá»—i 401)
GET {{baseUrl}}/Booking/1

### ===== DETAILED RESPONSE EXAMPLES =====

### 37. Booking vá»›i full details (cÃ³ holiday pricing)
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [1, 3],
  "checkInDate": "2025-01-28T14:00:00",
  "checkOutDate": "2025-01-30T12:00:00",
  "bookingType": "Online"
}

> {%
    client.global.set("booking_detail_id", response.body.data.bookingId);
%}

### 38. Get booking details vá»›i BookingRooms
GET {{baseUrl}}/Booking/{{booking_detail_id}}
Authorization: Bearer {{customer_token}}

### ===== PERFORMANCE TEST: MULTIPLE BOOKINGS =====

### 39. Táº¡o nhiá»u booking liÃªn tiáº¿p (stress test)
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{customer_token}}

{
  "customerId": 1,
  "roomIds": [4],
  "checkInDate": "2025-03-20T14:00:00",
  "checkOutDate": "2025-03-22T12:00:00",
  "bookingType": "Online"
}

### 40. Kiá»ƒm tra tá»•ng sá»‘ booking cá»§a customer
GET {{baseUrl}}/Booking/my-bookings
Authorization: Bearer {{customer_token}}

### ===== NOTES & CHECKLIST =====

# ğŸ“Œ LÆ¯U Ã QUAN TRá»ŒNG:
# âœ… Táº¥t cáº£ Status vÃ  Type Ä‘á»u láº¥y tá»« CommonCode
# âœ… Sá»­ dá»¥ng CodeName Ä‘á»ƒ query (vd: "Online", "Unpaid", "Available")
# âœ… Holiday Pricing tá»± Ä‘á»™ng Ã¡p dá»¥ng dá»±a trÃªn StartDate vÃ  EndDate
# âœ… GiÃ¡ tÃ­nh theo: BasePriceNight + PriceAdjustment (náº¿u cÃ³ holiday)
# âœ… Deposit máº·c Ä‘á»‹nh lÃ  30% TotalAmount
# âœ… Booking tá»± Ä‘á»™ng há»§y sau 15 phÃºt náº¿u khÃ´ng thanh toÃ¡n

# ğŸ’° Holiday Pricing Summary:
# Táº¿t NguyÃªn ÄÃ¡n (28/01-03/02/2025):
#   - Room 101/102: +300k/Ä‘Ãªm (800k â†’ 1,100k)
#   - Room 201: +500k/Ä‘Ãªm (1,500k â†’ 2,000k)
#
# Lá»… 30/4-1/5 (30/04-03/05/2025):
#   - Room 101/102: +200k/Ä‘Ãªm (800k â†’ 1,000k)
#   - Room 201: +300k/Ä‘Ãªm (1,500k â†’ 1,800k)
#
# Quá»‘c KhÃ¡nh 2/9 (01/09-03/09/2025):
#   - Room 101/102: +200k/Ä‘Ãªm (800k â†’ 1,000k)
#   - Room 201: +300k/Ä‘Ãªm (1,500k â†’ 1,800k)

