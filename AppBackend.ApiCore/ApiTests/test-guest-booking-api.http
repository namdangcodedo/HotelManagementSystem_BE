### Test Guest Booking API (Kh√¥ng c·∫ßn ƒëƒÉng k√Ω/ƒëƒÉng nh·∫≠p)
### Author: Hotel Management Team
### Date: 2025-01-19
### Compatible with: IntelliJ HTTP Client & VS Code REST Client

# Variables
@baseUrl = http://localhost:8080/api

### ===== AUTHENTICATION (Optional - for comparison) =====

### 1. ƒêƒÉng nh·∫≠p Admin ƒë·ªÉ l·∫•y token (optional - ƒë·ªÉ so s√°nh)
POST {{baseUrl}}/Authentication/login
Content-Type: application/json

{
  "email": "admin@hotel.com",
  "password": "Admin@123"
}

> {%
    client.global.set("auth_token", response.body.data.token);
%}

### ===== PUBLIC: CHECK AVAILABILITY =====

### 2. Ki·ªÉm tra ph√≤ng available (Public - kh√¥ng c·∫ßn authentication)
POST {{baseUrl}}/Booking/check-availability
Content-Type: application/json

{
  "roomIds": [1, 2],
  "checkInDate": "2025-10-25T14:00:00",
  "checkOutDate": "2025-10-27T12:00:00"
}

### ===== GUEST BOOKING - BASIC FLOW =====

### 3. Guest Booking - L·∫ßn ƒë·∫ßu (t·∫°o customer m·ªõi)
# Guest ch·ªâ c·∫ßn nh·∫≠p th√¥ng tin c√° nh√¢n, kh√¥ng c·∫ßn ƒëƒÉng k√Ω t√†i kho·∫£n
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn Kh√°ch",
  "email": "khach.guest@example.com",
  "phoneNumber": "0987654321",
  "identityCard": "079123456789",
  "address": "456 Nguy·ªÖn Hu·ªá, Q1, TP.HCM",
  "roomIds": [1],
  "checkInDate": "2025-10-25T14:00:00",
  "checkOutDate": "2025-10-27T12:00:00",
  "specialRequests": "View bi·ªÉn, t·∫ßng cao",
  "bookingType": "Online"
}

> {%
    client.global.set("guest_booking_id", response.body.data.bookingId);
    client.global.set("guest_payment_url", response.body.data.paymentUrl);
    client.global.set("guest_customer_id", response.body.data.customerId);
%}

### 4. Guest Booking - L·∫ßn 2 (c√πng email/phone - t√¨m customer c≈©)
# Khi guest book l·∫ßn 2 v·ªõi c√πng email ho·∫∑c phone, h·ªá th·ªëng s·∫Ω t√¨m customer c≈©
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn Kh√°ch",
  "email": "khach.guest@example.com",
  "phoneNumber": "0987654321",
  "identityCard": "079123456789",
  "address": "456 Nguy·ªÖn Hu·ªá, Q1, TP.HCM",
  "roomIds": [2],
  "checkInDate": "2025-11-01T14:00:00",
  "checkOutDate": "2025-11-03T12:00:00",
  "specialRequests": "G·∫ßn thang m√°y",
  "bookingType": "Online"
}

> {%
    client.global.set("guest_booking_id_2", response.body.data.bookingId);
%}

### 5. Guest Booking - Multiple Rooms (ƒë·∫∑t nhi·ªÅu ph√≤ng)
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Tr·∫ßn Th·ªã Lan",
  "email": "lan.guest@example.com",
  "phoneNumber": "0912345678",
  "identityCard": "001234567890",
  "address": "789 L√™ L·ª£i, Q3, TP.HCM",
  "roomIds": [1, 2, 3],
  "checkInDate": "2025-11-15T14:00:00",
  "checkOutDate": "2025-11-17T12:00:00",
  "specialRequests": "3 ph√≤ng g·∫ßn nhau cho gia ƒë√¨nh",
  "bookingType": "Online"
}

> {%
    client.global.set("guest_booking_id_3", response.body.data.bookingId);
%}

### 6. Guest Booking - D·ªãp T·∫øt (v·ªõi Holiday Pricing)
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "L√™ VƒÉn T·∫øt",
  "email": "tet.guest@example.com",
  "phoneNumber": "0909123456",
  "roomIds": [1, 3],
  "checkInDate": "2025-01-28T14:00:00",
  "checkOutDate": "2025-01-30T12:00:00",
  "specialRequests": "Booking d·ªãp T·∫øt",
  "bookingType": "Online"
}

> {%
    client.global.set("guest_booking_tet_id", response.body.data.bookingId);
%}

### ===== PAYMENT FLOW (GUEST) =====

### 7. X√°c nh·∫≠n thanh to√°n (PayOS callback - Public endpoint)
POST {{baseUrl}}/Booking/confirm-payment
Content-Type: application/json

{
  "bookingId": {{guest_booking_id}},
  "orderCode": "251019143500",
  "status": "PAID"
}

### ===== ERROR CASES: BAD REQUEST (400) =====

### 8. Guest Booking - Thi·∫øu th√¥ng tin b·∫Øt bu·ªôc
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn A",
  "email": "",
  "phoneNumber": "",
  "roomIds": [1],
  "checkInDate": "2025-10-25T14:00:00",
  "checkOutDate": "2025-10-27T12:00:00"
}

### 9. Guest Booking - Ng√†y check-in trong qu√° kh·ª©
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn B",
  "email": "test@example.com",
  "phoneNumber": "0987654321",
  "roomIds": [1],
  "checkInDate": "2025-01-01T14:00:00",
  "checkOutDate": "2025-01-03T12:00:00"
}

### 10. Guest Booking - Check-out tr∆∞·ªõc check-in
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn C",
  "email": "test2@example.com",
  "phoneNumber": "0987654322",
  "roomIds": [1],
  "checkInDate": "2025-10-27T14:00:00",
  "checkOutDate": "2025-10-25T12:00:00"
}

### ===== ERROR CASES: NOT FOUND (404) =====

### 11. Guest Booking - Room kh√¥ng t·ªìn t·∫°i
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Nguy·ªÖn VƒÉn D",
  "email": "test3@example.com",
  "phoneNumber": "0987654323",
  "roomIds": [99999],
  "checkInDate": "2025-10-25T14:00:00",
  "checkOutDate": "2025-10-27T12:00:00"
}

### ===== ERROR CASES: CONFLICT (409) =====

### 12. Guest Booking - Ph√≤ng ƒëang b·ªã lock (test race condition)
# Ch·∫°y 2 request n√†y ƒë·ªìng th·ªùi ƒë·ªÉ test
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Guest A",
  "email": "guestA@example.com",
  "phoneNumber": "0900000001",
  "roomIds": [1],
  "checkInDate": "2025-12-01T14:00:00",
  "checkOutDate": "2025-12-03T12:00:00"
}

### 13. Guest Booking - C√πng ph√≤ng c√πng th·ªùi gian (t·ª´ tab kh√°c)
POST {{baseUrl}}/Booking/guest
Content-Type: application/json

{
  "fullName": "Guest B",
  "email": "guestB@example.com",
  "phoneNumber": "0900000002",
  "roomIds": [1],
  "checkInDate": "2025-12-01T14:00:00",
  "checkOutDate": "2025-12-03T12:00:00"
}

### ===== COMPARISON: REGISTERED USER vs GUEST =====

### 14. Registered User Booking (c·∫ßn authentication) - ƒë·ªÉ so s√°nh
POST {{baseUrl}}/Booking
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "customerId": 1,
  "roomIds": [4],
  "checkInDate": "2025-10-25T14:00:00",
  "checkOutDate": "2025-10-27T12:00:00",
  "specialRequests": "Booking v·ªõi t√†i kho·∫£n ƒë√£ ƒëƒÉng k√Ω",
  "bookingType": "Online"
}

### ===== NOTES & BEST PRACTICES =====

# üìå L∆ØU √ù QUAN TR·ªåNG:
# ‚úÖ Guest Booking KH√îNG c·∫ßn authentication - d√†nh cho kh√°ch v√£ng lai
# ‚úÖ Registered User Booking C·∫¶N authentication - d√†nh cho kh√°ch h√†ng th√¢n thi·∫øt
# ‚úÖ Guest ch·ªâ c·∫ßn: FullName, Email, PhoneNumber (b·∫Øt bu·ªôc)
# ‚úÖ CMND v√† Address l√† optional
# ‚úÖ H·ªá th·ªëng t·ª± ƒë·ªông t·∫°o/t√¨m Customer d·ª±a tr√™n Email ho·∫∑c PhoneNumber
# ‚úÖ Guest c√≥ th·ªÉ booking nhi·ªÅu l·∫ßn m√† kh√¥ng c·∫ßn t√†i kho·∫£n
# ‚úÖ L·ªãch s·ª≠ booking ƒë∆∞·ª£c l∆∞u theo email/phone ƒë·ªÉ ti·ªán tra c·ª©u

# üéØ KHI N√ÄO D√ôNG GUEST BOOKING:
# - Kh√°ch h√†ng l·∫ßn ƒë·∫ßu, ch∆∞a mu·ªën ƒëƒÉng k√Ω
# - C·∫ßn ƒë·∫∑t ph√≤ng nhanh, kh√¥ng mu·ªën t·∫°o t√†i kho·∫£n
# - Kh√°ch n∆∞·ªõc ngo√†i (tourist)
# - One-time booking

# üéØ KHI N√ÄO D√ôNG REGISTERED USER BOOKING:
# - Kh√°ch h√†ng th∆∞·ªùng xuy√™n
# - Mu·ªën qu·∫£n l√Ω l·ªãch s·ª≠ booking
# - Mu·ªën nh·∫≠n ∆∞u ƒë√£i th√†nh vi√™n
# - C·∫ßn t√≠nh nƒÉng n√¢ng cao (modify booking, loyalty points, etc.)

# üí∞ GI√Å T√çNH GI·ªêNG NHAU:
# - Guest v√† Registered User ƒë·ªÅu c√≥ c√πng gi√°
# - Holiday pricing √°p d·ª•ng cho c·∫£ 2
# - Deposit: 30% t·ªïng ti·ªÅn
# - Payment timeout: 15 ph√∫t

# üîí B·∫¢O M·∫¨T:
# - Guest booking validation email/phone
# - Room locking mechanism gi·ªëng nhau
# - Payment qua PayOS (secure)
# - Auto-cancel sau 15 ph√∫t n·∫øu kh√¥ng thanh to√°n

# üìä RESPONSE FORMAT:
# {
#   "isSuccess": true,
#   "message": "T·∫°o booking th√†nh c√¥ng. Vui l√≤ng thanh to√°n trong 15 ph√∫t!",
#   "data": {
#     "bookingId": 123,
#     "customerId": 45,
#     "customerName": "Nguy·ªÖn VƒÉn Kh√°ch",
#     "roomIds": [1, 2],
#     "roomNumbers": ["101", "102"],
#     "checkInDate": "2025-10-25T14:00:00",
#     "checkOutDate": "2025-10-27T12:00:00",
#     "totalAmount": 3200000,
#     "depositAmount": 960000,
#     "paymentUrl": "https://pay.payos.vn/web/abc123",
#     "createdAt": "2025-10-19T10:30:00"
#   },
#   "statusCode": 201
# }

# üß™ TEST CHECKLIST:
# [ ] Guest booking l·∫ßn ƒë·∫ßu (t·∫°o customer m·ªõi)
# [ ] Guest booking l·∫ßn 2 (c√πng email/phone - t√¨m customer c≈©)
# [ ] Guest booking multiple rooms
# [ ] Guest booking v·ªõi holiday pricing
# [ ] Guest payment confirmation
# [ ] Error: Thi·∫øu th√¥ng tin b·∫Øt bu·ªôc
# [ ] Error: Ng√†y kh√¥ng h·ª£p l·ªá
# [ ] Error: Room kh√¥ng t·ªìn t·∫°i
# [ ] Error: Race condition (2 ng∆∞·ªùi ƒë·∫∑t c√πng ph√≤ng)
# [ ] So s√°nh v·ªõi registered user booking
